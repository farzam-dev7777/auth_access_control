<div class="container mx-auto px-4 py-8">
  <div class="mb-8">
    <div class="flex justify-between items-start">
      <div>
        <h1 class="text-3xl font-bold text-gray-900"><%= @organization.name %></h1>
        <p class="text-gray-600 mt-2">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
            <%= @organization.org_type.humanize %>
          </span>
          • <%= pluralize(@organization.active_members_count, 'member') %>
        </p>
      </div>

      <div class="flex space-x-2">
        <% if @membership&.role == 'admin' %>
          <%= link_to "Edit", edit_organization_path(@organization),
                      class: "bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded" %>
          <%= link_to "Analytics", analytics_organization_path(@organization),
                      class: "bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded" %>
          <%= link_to "Members", members_organization_path(@organization),
                      class: "bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded" %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Organization Details -->
    <div class="lg:col-span-2">
      <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Organization Details</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <h3 class="text-sm font-medium text-gray-500">Organization Type</h3>
            <p class="text-sm text-gray-900"><%= @organization.org_type.humanize %></p>
          </div>

          <div>
            <h3 class="text-sm font-medium text-gray-500">Your Role</h3>
            <p class="text-sm text-gray-900">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                <%= @membership&.role&.humanize %>
              </span>
            </p>
          </div>

          <% if @organization.min_age || @organization.max_age %>
            <div>
              <h3 class="text-sm font-medium text-gray-500">Age Restrictions</h3>
              <p class="text-sm text-gray-900">
                <%= @organization.min_age || 'Any' %> - <%= @organization.max_age || 'Any' %> years
              </p>
            </div>
          <% end %>

          <div>
            <h3 class="text-sm font-medium text-gray-500">Minors Allowed</h3>
            <p class="text-sm text-gray-900">
              <%= @organization.allow_minors ? 'Yes' : 'No' %>
            </p>
          </div>

          <% if @organization.requires_parental_consent %>
            <div>
              <h3 class="text-sm font-medium text-gray-500">Parental Consent Required</h3>
              <p class="text-sm text-gray-900">Yes</p>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Participation Status -->
      <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Your Participation Status</h2>

        <% service = ParticipationService.new(current_user, @organization) %>
        <% status = service.get_participation_status %>

        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-gray-700">Can Participate</span>
            <span class="<%= status[:can_participate] ? 'text-green-600' : 'text-red-600' %>">
              <%= status[:can_participate] ? '✓ Allowed' : '✗ Restricted' %>
            </span>
          </div>

          <div class="flex items-center justify-between">
            <span class="text-sm font-medium text-gray-700">Age Restrictions</span>
            <span class="<%= status[:age_restrictions_passed] ? 'text-green-600' : 'text-red-600' %>">
              <%= status[:age_restrictions_passed] ? '✓ Passed' : '✗ Failed' %>
            </span>
          </div>

          <% if current_user.requires_parental_consent? %>
            <div class="flex items-center justify-between">
              <span class="text-sm font-medium text-gray-700">Parental Consent</span>
              <span class="<%= status[:consent_status] == 'granted' ? 'text-green-600' : 'text-red-600' %>">
                <%= status[:consent_status].humanize %>
              </span>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Recent Activities -->
    <div class="lg:col-span-1">
      <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Recent Activities</h2>

        <% if @recent_activities.any? %>
          <div class="space-y-3">
            <% @recent_activities.each do |activity| %>
              <div class="flex items-start space-x-3">
                <div class="flex-shrink-0">
                  <div class="h-8 w-8 bg-blue-100 rounded-full flex items-center justify-center">
                    <span class="text-blue-600 text-xs font-medium">
                      <%= activity.user.first_name.first %>
                    </span>
                  </div>
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-sm text-gray-900">
                    <span class="font-medium"><%= activity.user.first_name %></span>
                    <%= activity.action.humanize.downcase %>
                  </p>
                  <p class="text-xs text-gray-500">
                    <%= time_ago_in_words(activity.performed_at) %> ago
                  </p>
                </div>
              </div>
            <% end %>
          </div>

          <div class="mt-4">
            <%= link_to "View All Activities", analytics_organization_path(@organization),
                        class: "text-blue-600 hover:text-blue-500 text-sm font-medium" %>
          </div>
        <% else %>
          <p class="text-gray-500 text-sm">No recent activities</p>
        <% end %>
      </div>
    </div>
  </div>
</div>
